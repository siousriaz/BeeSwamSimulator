-- ===== AUTO PRINTER ONLY =====

repeat task.wait() until game:IsLoaded()

local RS = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Http = game:GetService("HttpService")

local Player = Players.LocalPlayer
local Events = RS:WaitForChild("Events")

-- ===== CONFIG RIÊNG =====
getgenv().PRINTER_CONFIG = {
    Enable = true,
    Webhook = "https://discord.com/api/webhooks/XXXXX",
    PingId = "1042796564235702344",
    Cooldown = 10 -- giây
}

-- ===== CACHE =====
local Cache = { data = nil, last = 0 }

local function getCache()
    if tick() - Cache.last > 1 then
        local ok, res = pcall(function()
            return require(RS.ClientStatCache):Get()
        end)
        if ok then
            Cache.data = res
            Cache.last = tick()
        end
    end
    return Cache.data
end

-- ===== INVENTORY =====
local function getInventory()
    local cache = getCache()
    if not cache or not cache.Eggs then return {} end

    return {
        ["Star Egg"] = tonumber(cache.Eggs.Star) or 0
    }
end

-- ===== WEBHOOK =====
local function sendWebhook(title)
    if not getgenv().PRINTER_CONFIG.Webhook then return end

    local data = {
        content = "<@" .. tostring(getgenv().PRINTER_CONFIG.PingId) .. ">",
        embeds = {{
            title = title,
            color = 16777215,
            fields = {
                { name = "Player", value = Player.Name, inline = false }
            },
            footer = { text = "Auto Printer" }
        }}
    }

    pcall(function()
        request({
            Url = getgenv().PRINTER_CONFIG.Webhook,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = Http:JSONEncode(data)
        })
    end)
end

-- ===== AUTO PRINTER =====
local LAST_PRINT = 0

local function autoPrinter()
    if not getgenv().PRINTER_CONFIG.Enable then return end
    if tick() - LAST_PRINT < getgenv().PRINTER_CONFIG.Cooldown then return end

    local inv = getInventory()
    if (inv["Star Egg"] or 0) > 0 then
        LAST_PRINT = tick()
        Events.StickerPrinterActivate:FireServer("Star Egg")
        sendWebhook("⭐ Star Egg roll printer!!!")
    end
end

-- ===== LOOP =====
while true do
    autoPrinter()
    task.wait(1)
end
